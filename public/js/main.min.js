$(function(){function s(){$("#js-jewmapHamburger").removeClass("active"),$("#js-classifier").removeClass("open"),$(window).width()<=600&&($(".leaflet-control-container").removeClass("hide"),$("#js-lang").removeClass("hide"))}$(window).on("resize",function(){s()}),$("#js-navListWrapper ul>li>a").on("click",function(){s()}),$('#js-classifier button[type="submit"]').click(function(e){e.preventDefault()}),$('#js-classifier input[type="text"]').on("change keydown keyup",function(){var t=$(this).val().toUpperCase(),s=t.length;$("#js-classifier ul").find("a").each(function(){var e=$(this).closest("li"),a=$(this).text().toUpperCase();(a=a.substring(0,s))!==t?e.hide():e.show()})});window.classifier={addClassifier:function(e,a){!function(a,e){sortedArray=function(a){a.sort(function(e,a){return e.name<a.name?-1:e.name>a.name?1:0}),a.forEach(function(e){if("Санкт-Петербург"===e.name)return a.splice(a.indexOf(e),1),a.unshift(e),!1}),a.forEach(function(e){if("Москва"===e.name)return a.splice(a.indexOf(e),1),a.unshift(e),!1});for(var e=Math.ceil(a.length/2),t=a.splice(0,e),s=[],o=0;o<e;o++)void 0!==t[o]&&s.push(t[o]),void 0!==a[o]&&s.push(a[o]);return a=s}(e);var t;t=sortedArray,Array.prototype.forEach.call(t,function(e){var a=document.createDocumentFragment(),t=document.querySelector("#js-templateClassifierItem").content.querySelector(".classifier__list-item").cloneNode(!0);t.querySelector(".classifier__list-link").setAttribute("data-id",e.id),t.querySelector(".classifier__list-link").textContent=e.name,t.querySelector(".classifier__list-link").setAttribute("data-status",e.status),t.querySelector(".classifier__list-link").setAttribute("data-point",e.point),a.appendChild(t),document.querySelector(".classifier__list").append(a)}),$("#js-classifierScrollbar").scrollBox(),$(".classifier__list-link").on("click",function(){var e=$(this).attr("data-point").split(",");window.util.flyTo(a,[parseFloat(e[0]),parseFloat(e[1])]),s()}),$(".jewmap__hamburger").on("click",function(){$("#js-jewmapHamburger").toggleClass("active"),$("#js-classifier").toggleClass("open"),$(window).width()<=600&&($(".leaflet-control-container").toggleClass("hide"),$("#js-lang").toggleClass("hide")),$(".popup").hasClass("open")&&($(".popup").removeClass("open"),$("#js-navListWrapper ul>li>a").removeClass("active"))})}(e,a)}}}),$(function(){window.geo={addGeo:function(e,a){}}}),$(function(){$("#js-lang a").on("click",function(){$("#js-lang a").removeClass("active"),$(this).addClass("active")})}),$(function(){var n=[],e=new L.LatLngBounds([60,21],[69,167]);$(window).width()<=600&&(e=new L.LatLngBounds([40,25],[55,180])),L.mapbox.accessToken="pk.eyJ1IjoiYWxpYXBrbyIsImEiOiJjangyenVmeGMwcTFjM3lvNGhsdmUzejRoIn0.zdJYMN5sxS2SJXZV2Lb3aA";var m=L.map("map",{doubleClickZoom:!1,zoomControl:!0,zoomDelta:.25,zoomSnap:0,minZoom:2}).setView([63.674041,99.742382],4).addLayer(L.mapbox.styleLayer("mapbox://styles/aliapko/ck0066wpr2azz1cpl59flq3df"));m.fitBounds(e,{padding:[20,20]});var a=L.latLng(-89.98155760646617,-180),t=L.latLng(89.99346179538875,230),s=L.latLngBounds(a,t);m.setMaxBounds(s),m.on("drag",function(){m.panInsideBounds(s,{animate:!1})}),$.ajax({method:"GET",url:"post.php",data:{request:1}}).done(function(e){var a=jQuery.parseJSON(e);console.log(a),o(a),i(n);var t=n.slice(0);window.classifier.addClassifier(m,t),window.geo.addGeo(m,n)});var o=function(e){Array.prototype.forEach.call(e,function(t,e){var a={id:e,name:t.name_city,point:[""===t.latitude_city||null===t.latitude_city?"":parseFloat(t.latitude_city),""===t.longitude_city||null===t.longitude_city?"":parseFloat(t.longitude_city)],status:t.status_city,childs:[]},s={name:t.post_title,address:t.address,point:[""===t.latitude||null===t.latitude?"":parseFloat(t.latitude),""===t.longitude||null===t.longitude?"":parseFloat(t.longitude)],phone:t.phone,email:t.email,site:t.site};if(0===n.length)n.push(a),n[0].childs.push(s);else{var o=!1;Array.prototype.forEach.call(n,function(e,a){e.name===t.name_city&&(o=!0,e.childs.push(s))}),!1===o&&(n.push(a),n[n.length-1].childs.push(s))}})},i=function(e){var t=L.mapbox.featureLayer(),s=L.mapbox.featureLayer(),o=L.mapbox.featureLayer(),n=L.mapbox.featureLayer(),i=L.mapbox.featureLayer(),a={top:[0,20],"top-left":[0,0],"top-right":[0,0],bottom:[0,-20],"bottom-left":[25,-35],"bottom-right":[-25,-35],left:[10,-10],right:[-10,-10]},r=new L.popup({offset:a,closeButton:!0,closeOnClick:!0});function l(e){var a=e.target._latlng;window.util.flyTo(m,[a.lat,a.lng])}function c(e){var a=e.target._latlng,t=e.target.options.name,s=e.target.options.address,o=JSON.parse(e.target.options.phone),n=e.target.options.email,i=e.target.options.site;console.log(o),window.util.flyTo(m,[a.lat,a.lng]),window.util.addPopup(m,r,{name:t,lng:parseFloat(a.lng),lat:parseFloat(a.lat),address:s,phone:o,email:n,site:i})}Array.prototype.forEach.call(e,function(e){if(""!==e.point[0]||""!==e.point[1])if("1"===e.status)if("Москва"===e.name){var a='<div class="jewmap__pin"><div class="jewmap__pin-icon"></div><span class="jewmap__pin-label">'+e.name+"</span></div>";L.marker(e.point,{icon:L.divIcon({html:a,className:"capital"}),zIndexOffset:40}).addTo(t).on("click",l)}else{a='<div class="jewmap__pin"><div class="jewmap__pin-icon"></div><span class="jewmap__pin-label">'+e.name+"</span></div>";L.marker(e.point,{icon:L.divIcon({html:a,className:"district"}),zIndexOffset:30}).addTo(s).on("click",l)}else if("2"===e.status){a='<div class="jewmap__pin"><div class="jewmap__pin-icon"></div><span class="jewmap__pin-label">'+e.name+"</span></div>";L.marker(e.point,{icon:L.divIcon({html:a,className:"region"}),zIndexOffset:20}).addTo(o).on("click",l)}else if("3"===e.status||null===e.status){a='<div class="jewmap__pin"><div class="jewmap__pin-icon"></div><span class="jewmap__pin-label">'+e.name+"</span></div>";L.marker(e.point,{icon:L.divIcon({html:a,className:"city"}),zIndexOffset:10}).addTo(n).on("click",l)}Array.prototype.forEach.call(e.childs,function(e){if(""!==e.point[0]||""!==e.point[1]){var t=[];if(void 0!==e.phone){var a=e.phone.split(";");0!==a.length&&Array.prototype.forEach.call(a,function(e){var a=e.split(" ").join("").split("(").join("").split(")").join("").split("-").join("").split("?").join("");t.push({phone:e,phoneLink:a})})}L.marker(e.point,{icon:L.divIcon({html:'<div class="jewmap__pin"><div class="jewmap__pin-icon"></div></div>',className:"org"}),id:e.id,name:e.name,address:e.address,phone:JSON.stringify(t),email:e.email,site:e.site}).addTo(i).on("click",c)}})}),m.addLayer(s),m.addLayer(t);function p(e){$(e+" .jewmap__pin-label").css("opacity","1"),$(e+" .jewmap__pin-label").css("pointer-events","auto")}function d(e){$(e+" .jewmap__pin-label").css("opacity","0"),$(e+" .jewmap__pin-label").css("pointer-events","none")}function u(e){$(window).width()<575?2<e&&e<3?(m.addLayer(o),d(".region"),m.removeLayer(n)):3<e&&e<4?(m.addLayer(o),p(".region"),m.removeLayer(n)):4<e&&e<5?(m.addLayer(o),p(".region"),m.addLayer(n),d(".city")):5<e&&e<10?(m.removeLayer(i),m.addLayer(t),m.addLayer(s),m.addLayer(o),p(".region"),m.addLayer(n),p(".city")):e<2?(m.addLayer(t),m.addLayer(s),m.removeLayer(o),m.removeLayer(n)):10<=e&&(m.addLayer(i),m.removeLayer(t),m.removeLayer(s),m.removeLayer(o),m.removeLayer(n)):4<e&&e<5?(m.addLayer(o),d(".region"),m.removeLayer(n)):5<e&&e<6?(m.addLayer(o),p(".region"),m.removeLayer(n)):6<e&&e<7?(m.addLayer(o),p(".region"),m.addLayer(n),d(".city")):7<e&&e<10?(m.removeLayer(i),m.addLayer(t),m.addLayer(s),m.addLayer(o),p(".region"),m.addLayer(n),p(".city")):e<4?(m.addLayer(t),m.addLayer(s),m.removeLayer(o),m.removeLayer(n)):10<=e&&(m.addLayer(i),m.removeLayer(t),m.removeLayer(s),m.removeLayer(o),m.removeLayer(n))}u(4),m.on("zoomend",function(e){var a=e.target._zoom;u(a)})}}),$(function(){function a(){$("#js-navHamburger").removeClass("active"),$("#js-navListWrapper").slideUp()}$("#js-navListWrapper ul>li>a").on("click",function(){$("#js-navListWrapper ul>li>a").removeClass("active"),$(this).addClass("active"),$(window).width()<=600&&a()}),$("#js-navHamburger").on("click",function(){$("#js-navHamburger").toggleClass("active"),$("#js-navListWrapper").slideToggle()}),$(document).click(function(e){if($(window).width()<=600){if($(e.target).closest("#js-navListWrapper").length)return;if($(e.target).closest("#js-navHamburger").length)return;a(),event.stopPropagation()}}),$(window).on("resize",function(){600<$(window).width()?($("#js-navListWrapper").show(),$("#js-navHamburger").removeClass("active")):a()})}),$(window).on("load",function(){$("#js-overlay").fadeIn(),$(window).width()<=600&&($(".leaflet-control-container").addClass("hide"),$("#js-infoButton").addClass("hide")),$("#js-overlay .overlay__close").on("click",function(){$("#js-overlay").fadeOut(),$(window).width()<=600&&($(".leaflet-control-container").removeClass("hide"),$("#js-infoButton").removeClass("hide"))}),$(document).click(function(e){$(e.target).closest("#js-overlay").length||($("#js-overlay").fadeOut(),event.stopPropagation(),$(window).width()<=600&&($(".leaflet-control-container").removeClass("hide"),$("#js-infoButton").removeClass("hide")))})}),$(function(){$(".popup__main").scrollBox(),$("#js-navListWrapper ul>li>a").on("click",function(){var e=$(this).attr("data-popup");$("#js-"+e).hasClass("open")||($("#js-jewmapHamburger").addClass("move"),$("#js-jewmapSearch").addClass("move"),$(".popup").removeClass("open"),$("#js-"+e).addClass("open"))}),$(".popup__close").on("click",function(){$(".popup").removeClass("open"),$("#js-jewmapHamburger").removeClass("move"),$("#js-jewmapSearch").removeClass("move"),$("#js-navListWrapper ul>li>a").removeClass("active")}),$(document).click(function(e){$(e.target).closest("#js-nav").length||$(e.target).closest(".popup").length||($(".popup").removeClass("open"),$("#js-jewmapHamburger").removeClass("move"),$("#js-jewmapSearch").removeClass("move"),$("#js-navListWrapper ul>li>a").removeClass("active"),event.stopPropagation())})}),function(n,e,a){"use strict";var i="scrollBox",t={containerClass:"sb-container",containerNoScrollClass:"sb-container-noscroll",contentClass:"sb-content",scrollbarContainerClass:"sb-scrollbar-container",scrollBarClass:"sb-scrollbar"};function s(e,a){this.element=e,this.settings=n.extend({},t,a),this._defaults=t,this._name=i,this.init()}n.extend(s.prototype,{init:function(){this.addScrollbar(),this.addEvents(),this.onResize()},addScrollbar:function(){n(this.element).addClass(this.settings.containerClass),this.wrapper=n("<div class='"+this.settings.contentClass+"' />"),this.wrapper.append(n(this.element).contents()),n(this.element).append(this.wrapper),this.scollbarContainer=n("<div class='"+this.settings.scrollbarContainerClass+"' />"),this.scrollBar=n("<div class='"+this.settings.scrollBarClass+"' />"),this.scollbarContainer.append(this.scrollBar),n(this.element).prepend(this.scollbarContainer)},addEvents:function(){this.wrapper.on("scroll."+i,n.proxy(this.onScroll,this)),n(e).on("resize."+i,n.proxy(this.onResize,this)),this.scrollBar.on("mousedown."+i,n.proxy(this.onMousedown,this)),this.scrollBar.on("touchstart."+i,n.proxy(this.onTouchstart,this))},onTouchstart:function(t){var s=this;t.preventDefault();var o=s.scrollBar[0].offsetTop;n(a).on("touchmove."+i,function(e){var a=e.touches[0].pageY-t.touches[0].pageY;s.scrollBar[0].style.top=Math.min(s.scollbarContainer[0].clientHeight-s.scrollBar[0].clientHeight,Math.max(0,o+a))+"px",s.wrapper[0].scrollTop=s.wrapper[0].scrollHeight*s.scrollBar[0].offsetTop/s.scollbarContainer[0].clientHeight}),n(a).on("touchend."+i,function(){n(a).off("touchmove."+i),n(a).off("touchend."+i)})},onMousedown:function(t){var s=this;t.preventDefault();var o=s.scrollBar[0].offsetTop;n(a).on("mousemove."+i,function(e){var a=e.pageY-t.pageY;s.scrollBar[0].style.top=Math.min(s.scollbarContainer[0].clientHeight-s.scrollBar[0].clientHeight,Math.max(0,o+a))+"px",s.wrapper[0].scrollTop=s.wrapper[0].scrollHeight*s.scrollBar[0].offsetTop/s.scollbarContainer[0].clientHeight}),n(a).on("mouseup."+i,function(){n(a).off("mousemove."+i),n(a).off("mouseup."+i)})},onResize:function(){this.wrapper.css("max-height",n(this.element).height());var e=this.wrapper[0].clientHeight;this.scrollBar.css("height",this.scollbarContainer[0].clientHeight*e/this.wrapper[0].scrollHeight+"px"),this.scollbarContainer[0].clientHeight<=this.scrollBar[0].clientHeight?n(this.element).addClass(this.settings.containerNoScrollClass):n(this.element).removeClass(this.settings.containerNoScrollClass),this.onScroll()},onScroll:function(){this.scrollBar.css("top",Math.min(this.scollbarContainer[0].clientHeight-this.scrollBar[0].clientHeight,this.scollbarContainer[0].clientHeight*this.wrapper[0].scrollTop/this.wrapper[0].scrollHeight)+"px")}}),n.fn[i]=function(e){return this.each(function(){n.data(this,"plugin_"+i)||n.data(this,"plugin_"+i,new s(this,e))})}}(jQuery,window,document),$(function(){window.util={flyTo:function(e,a,t){!function(e,a,t){void 0===t&&(t=(t=e.getZoom())<=10?10:t),e.flyTo([a[0],a[1]],t,{duration:1.1,easeLinearity:.45})}(e,a,t)},addPopup:function(e,a,t){!function(e,a,t){var s="https://yandex.by/maps/?ll="+t.lng+","+t.lat+"&z=16&text="+t.name.split(" ").join("%20"),o="";o+='<div class="sina-popup d-flex flex-column"><p class="sina-popup__name mb-1"><strong>'+t.name+"</strong></p>",""!==t.address&&(o+='<a href="'+s+'" class="sina-popup__text sina-popup__address d-flex align-items-start mb-1">'+t.address+"</p>"),Array.prototype.forEach.call(t.phone,function(e,a){o+='<a href="tel:'+e.phoneLink+'" class="sina-popup__text sina-popup__phone d-flex align-items-start mb-1">'+e.phone+"</a>",a<t.phone.length-1&&(o+=", ")}),""!==t.email&&(o+='<a href="mailto:'+t.email+'" class="sina-popup__text sina-popup__email d-flex align-items-start mb-1">'+t.email+"</p>"),""!==t.site&&(o+='<a href="'+t.site+'" class="sina-popup__text sina-popup__site d-flex align-items-start mb-1">'+t.site+"</a>"),o+="</div>",a.setLatLng([t.lat,t.lng]).setContent(o).openOn(e)}(e,a,t)}}});
//# sourceMappingURL=main.min.js.map
